<!--pages/apply-audit/apply-audit.wxml-->
<view class="container">
  <!-- 认证状态检查 -->
  <view class="auth-status-section" wx:if="{{!isUserAuthenticated && applicationStatus === 'pending'}}">
    <view class="auth-tip">
      <text class="tip-icon">⚠️</text>
      <text class="tip-text">申请{{serviceName}}需要先完成实名认证</text>
      <button class="auth-btn" bindtap="goToRealNameAuth">去认证</button>
    </view>
  </view>
 
  <!-- 申请表单区域 -->
  <view class="form-section" wx:if="{{applicationStatus === 'pending' && isUserAuthenticated}}">
    <!-- 服务介绍 -->
    <view class="service-intro">
      <view class="service-icon">
        <image src="/images/{{serviceType}}-icon.png" class="service-img" mode="aspectFit"></image>
      </view>
      <view class="service-title">{{serviceTitle}}</view>
      <view class="service-desc">{{serviceDescription}}</view>
    </view>
 
    <view class="section-title">申请信息</view>
    
    <!-- 基本信息 -->
    <view class="form-group">
      <view class="group-title">基本信息</view>
      
      <view class="form-item">
        <text class="label">真实姓名</text>
        <input 
          class="input" 
          placeholder="请输入真实姓名" 
          value="{{formData.realName}}"
          disabled="{{isUserAuthenticated}}"
        />
        <text class="auth-hint" wx:if="{{isUserAuthenticated}}">实名认证信息</text>
      </view>
 
      <view class="form-item">
        <text class="label">学号</text>
        <input 
          class="input" 
          placeholder="请输入学号" 
          value="{{formData.studentId}}"
          disabled="{{isUserAuthenticated}}"
        />
        <text class="auth-hint" wx:if="{{isUserAuthenticated}}">实名认证信息</text>
      </view>
 
      <view class="form-item">
        <text class="label">手机号</text>
        <input 
          class="input" 
          placeholder="请输入11位手机号" 
          value="{{formData.phone}}"
          bindinput="onInputChange"
          data-field="phone"
          type="number"
          maxlength="11"
        />
      </view>
 
      <view class="form-item">
        <text class="label">学校名称</text>
        <input 
          class="input" 
          placeholder="请输入学校名称" 
          value="{{formData.schoolName}}"
          disabled="{{isUserAuthenticated}}"
        />
        <text class="auth-hint" wx:if="{{isUserAuthenticated}}">实名认证信息</text>
      </view>
 
      <view class="form-item">
        <text class="label">专业</text>
        <input 
          class="input" 
          placeholder="请输入专业名称" 
          value="{{formData.major}}"
          bindinput="onInputChange"
          data-field="major"
        />
      </view>
 
      <view class="form-item">
        <text class="label">年级</text>
        <input 
          class="input" 
          placeholder="请输入年级（如：大三）" 
          value="{{formData.grade}}"
          bindinput="onInputChange"
          data-field="grade"
        />
      </view>
    </view>
 
    <!-- 代课同学特有字段 -->
    <view class="form-group" wx:if="{{serviceType === 'teacher'}}">
      <view class="group-title">代课能力</view>
      
      <view class="form-item">
        <text class="label">个人介绍</text>
        <textarea 
          class="textarea" 
          placeholder="请简单介绍自己，展示你的优势..." 
          value="{{formData.selfIntroduction}}"
          bindinput="onInputChange"
          data-field="selfIntroduction"
          maxlength="200"
        ></textarea>
      </view>
 
      <view class="form-item">
        <text class="label">专业技能</text>
        <textarea 
          class="textarea" 
          placeholder="描述你的专业技能和特长..." 
          value="{{formData.skills}}"
          bindinput="onInputChange"
          data-field="skills"
          maxlength="200"
        ></textarea>
      </view>
 
      <view class="form-item">
        <text class="label">可用时间</text>
        <textarea 
          class="textarea" 
          placeholder="说明你通常的时间安排..." 
          value="{{formData.availableTime}}"
          bindinput="onInputChange"
          data-field="availableTime"
          maxlength="200"
        ></textarea>
      </view>
 
      <view class="form-item">
        <text class="label">代课经验</text>
        <textarea 
          class="textarea" 
          placeholder="描述你的代课经验..." 
          value="{{formData.experience}}"
          bindinput="onInputChange"
          data-field="experience"
          maxlength="200"
        ></textarea>
      </view>
    </view>
 
    <!-- 刷客特有字段 -->
    <view class="form-group" wx:if="{{serviceType === 'brusher'}}">
      <view class="group-title">刷课能力</view>
      
      <view class="form-item">
        <text class="label">个人介绍</text>
        <textarea 
          class="textarea" 
          placeholder="请简单介绍自己，展示你的优势..." 
          value="{{formData.selfIntroduction}}"
          bindinput="onInputChange"
          data-field="selfIntroduction"
          maxlength="200"
        ></textarea>
      </view>
 
      <view class="form-item">
        <text class="label">擅长领域</text>
        <textarea 
          class="textarea" 
          placeholder="如：高数、英语、编程等..." 
          value="{{formData.specialty}}"
          bindinput="onInputChange"
          data-field="specialty"
          maxlength="200"
        ></textarea>
      </view>
 
      <view class="form-item">
        <text class="label">熟悉工具</text>
        <textarea 
          class="textarea" 
          placeholder="如：学习通、雨课堂、MOOC等平台..." 
          value="{{formData.tools}}"
          bindinput="onInputChange"
          data-field="tools"
          maxlength="200"
        ></textarea>
      </view>
 
      <view class="form-item">
        <text class="label">服务范围</text>
        <textarea 
          class="textarea" 
          placeholder="说明你可以提供的服务类型..." 
          value="{{formData.serviceRange}}"
          bindinput="onInputChange"
          data-field="serviceRange"
          maxlength="200"
        ></textarea>
      </view>
    </view>
 
    <!-- 服务要求说明 -->
    <view class="requirements-section">
      <view class="section-title">申请要求</view>
      <view class="requirement-list">
        <view class="requirement-item" wx:for="{{serviceRequirements}}" wx:key="*this">
          <text class="requirement-number">{{index + 1}}</text>
          <text class="requirement-text">{{item}}</text>
        </view>
      </view>
    </view>
 
    <!-- 权益说明 -->
    <view class="benefits-section">
      <view class="section-title">权益保障</view>
      <view class="benefit-list">
        <view class="benefit-item" wx:for="{{serviceBenefits}}" wx:key="*this">
          <text class="benefit-icon">✓</text>
          <text class="benefit-text">{{item}}</text>
        </view>
      </view>
    </view>
 
    <!-- 提交按钮 -->
    <view class="submit-section">
      <button 
        class="submit-btn {{canSubmit ? 'enabled' : 'disabled'}}" 
        bindtap="submitApplication"
        disabled="{{!canSubmit || isSubmitting}}"
      >
        {{isSubmitting ? '提交中...' : '提交申请'}}
      </button>
      
      <button class="rule-btn" bindtap="onRuleTap">查看申请规则</button>
    </view>
  </view>
 
  <!-- 申请状态展示 -->
  <view class="status-section" wx:if="{{applicationStatus !== 'pending'}}">
    <view class="illustration">
      <image src="/images/audit_illustration.png" mode="widthFix" class="illustration-img"></image>
    </view>
 
    <view class="content">
      <view class="title">{{serviceName}}申请</view>
      <view class="status-card">
        <view class="status-item">
          <view class="status-label">申请类型</view>
          <view class="status-value">{{serviceName}}</view>
        </view>
        
        <view class="status-item">
          <view class="status-label">申请时间</view>
          <view class="status-value">{{applicationInfo.submitTime || '未知'}}</view>
        </view>
        
        <view class="status-item">
          <view class="status-label">审核状态</view>
          <view class="status-value status-{{applicationStatus}}">
            <text wx:if="{{applicationStatus === 'reviewing'}}">审核中</text>
            <text wx:if="{{applicationStatus === 'approved'}}">已通过</text>
            <text wx:if="{{applicationStatus === 'rejected'}}">已拒绝</text>
          </view>
        </view>
        
        <view class="status-item" wx:if="{{applicationStatus === 'reviewing'}}">
          <view class="status-label">预计完成时间</view>
          <view class="status-value">1-7个工作日</view>
        </view>
      </view>
 
      <view class="status-description">
        <text wx:if="{{applicationStatus === 'reviewing'}}">
          您的申请正在审核中，请耐心等待。审核结果将通过微信服务通知告知您。
        </text>
        <text wx:if="{{applicationStatus === 'approved'}}">
          恭喜您！申请已通过，现在可以接取相应的{{serviceName}}订单了。
        </text>
        <text wx:if="{{applicationStatus === 'rejected'}}">
          很抱歉，您的申请未通过审核。您可以重新申请或联系客服了解详情。
        </text>
      </view>
 
      <view class="action-buttons">
        <button 
          class="btn btn-rule" 
          bindtap="onRuleTap"
        >
          查看规则
        </button>
        
        <button 
          class="btn btn-withdraw" 
          bindtap="withdrawApplication"
          wx:if="{{applicationStatus === 'reviewing'}}"
        >
          撤销申请
        </button>
        
        <button 
          class="btn btn-primary" 
          bindtap="onBackTap"
        >
          {{applicationStatus === 'approved' ? '开始接单' : '我知道了'}}
        </button>
      </view>
    </view>
  </view>
</view>